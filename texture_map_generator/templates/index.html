<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Texture Map Generator</title>
    <style>
      body { background: #2d2d2d; color: #fff; font-family: sans-serif; }
      .container { width: 80%%; margin: auto; text-align: center; padding-top: 50px; }
      input[type=file] { margin: 20px 0; }
      button { padding: 10px 20px; background: #444; color: #fff; border: none; }
      button:hover { background: #666; }
      .map { display:inline-block; margin:10px; text-align:center; }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>Texture Map Generator</h1>
      <form id="main-form" action="/" method="post" enctype="multipart/form-data">
        <input id="img-input" type="file" name="images" multiple accept="image/*"><br>
        <h3>Diffuse Settings</h3>
        <label>Brightness <input type="range" name="brightness" min="0" max="200" value="100"></label>
        <label><input type="checkbox" name="brightness_enabled" checked> enable</label><br>
        <label>Contrast <input type="range" name="contrast" min="0" max="200" value="100"></label>
        <label><input type="checkbox" name="contrast_enabled" checked> enable</label><br>
        <label>Tint Strength <input type="range" name="tint_strength" min="0" max="100" value="50"></label>
        <label><input type="checkbox" name="tint_enabled" checked> enable</label>
        <input type="color" name="tint_color" value="#ffffff"><br>

        <h3>Map Strengths</h3>
        <label>Opacity <input type="range" name="strength_Opacity" min="0" max="100" value="50"></label><br>
        <label>AO <input type="range" name="strength_AO" min="0" max="100" value="50"></label><br>
        <label>Roughness <input type="range" name="strength_Roughness" min="0" max="100" value="50"></label><br>
        <label>Normal <input type="range" name="strength_Normal" min="0" max="100" value="50"></label><br>
        <label>Displacement <input type="range" name="strength_Displacement" min="0" max="100" value="50"></label><br>
        <label>Metallic <input type="range" name="strength_Metallic" min="0" max="100" value="50"></label><br>
        <label>Emissive <input type="range" name="strength_Emissive" min="0" max="100" value="50"></label><br>

        <h3>Options</h3>
        <label><input type="checkbox" name="invert_green"> Invert Green Channel</label><br>
        <label><input type="checkbox" name="metallic_enabled" checked> Metallic Enabled</label><br>
        <label><input type="checkbox" name="emissive_enabled"> Emissive Enabled</label>
        <input type="color" name="emissive_color" value="#f7f731"><br><br>
        <button type="submit" name="action" value="generate">Generate Maps</button>
        <button type="submit" name="action" value="create_ORM">Create ORM</button>
        <button type="submit" name="action" value="create_ERM">Create ERM</button>
      </form>
      <div id="preview" style="margin-top:40px;"></div>
    </div>
    <script>
      const form = document.getElementById('main-form');
      const imgInput = document.getElementById('img-input');
      let imageData = null;

      imgInput.addEventListener('change', () => {
        const file = imgInput.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          imageData = reader.result.split(',')[1];
          updatePreview();
        };
        reader.readAsDataURL(file);
      });

      form.querySelectorAll('input').forEach(el => {
        el.addEventListener('input', () => {
          if (imageData) updatePreview();
        });
      });

      function updatePreview() {
        const data = Object.fromEntries(new FormData(form).entries());
        data.image = imageData;
        fetch('/preview', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        }).then(r => r.json()).then(res => {
          const container = document.getElementById('preview');
          container.innerHTML = '';
          for (const [key, val] of Object.entries(res)) {
            const div = document.createElement('div');
            div.className = 'map';
            div.innerHTML = `<p>${key}</p><img src="data:image/png;base64,${val}" width="256" height="256">`;
            container.appendChild(div);
          }
        });
      }
    </script>
  </body>
</html>
